<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Intervip - Cadastro Corporativo</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="stylesheets/cadastro-vendas.css">
</head>

<body class="gerenciaIVP-body">
    <header class="header-modern">
        <div class="container-fluid">
            <div class="d-flex align-items-center">
                <a href="/main" class="d-flex align-items-center text-decoration-none">
                    <img class="logo me-3" src="images/logo.png" alt="Logo Intervip">
                </a>
            </div>
            <h1 class="header-title fs-4 fw-semibold text-white m-0">Cadastro Venda Corporativo</h1>
            <div class="d-flex align-items-center">
                
                <div class="user-info text-end me-4">
                    <p class="m-0 small text-white-80">Acessando como: <span class="fw-medium">{username}</span></p>
                    <p class="m-0 small text-white-80">Setor: <span class="fw-medium">{group}</span></p>
                </div>
                <button id="theme-toggle" class="btn btn-sm btn-outline-dark rounded-pill px-3">
                    <i class="bi bi-moon-stars"></i>
                </button>
                <button id="btnLogout" class="btn btn-sm btn-outline-danger rounded-pill px-3 ms-2">
                    <i class="bi bi-box-arrow-right"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="ivp-main">
        <div class="container py-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <a href="cadastro-de-vendas" class="btn btn-sm btn-outline-light rounded-pill px-3" title="Voltar ao Hub">
                    <i class="bi bi-arrow-left me-1"></i> Voltar para o Hub de Vendas
                </a>

                <button type="button" class="btn btn-sm btn-warning rounded-pill px-3 fw-bold" id="btn-abrir-modal-suporte">
                    <i class="bi bi-headset me-1"></i> Abrir chamado com o suporte
                </button>
            </div>
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    
                    <div id="tela-1-consulta">
                        <div class="ivp-card">
                            <div class="card-body p-4 p-md-5">
                                <h2 class="ivp-title mb-4">1. Consultar Cliente Corporativo</h2>
                                <fieldset class="form-section">
                                    <legend class="section-legend">Consulta por Documento</legend>
                                    <div class="row g-3">
                                        <div class="col-md-8">
                                            <label for="input-documento" class="form-label">CNPJ/CPF</label>
                                            <div class="input-group">
                                                <button class="btn btn-outline-primary" type="button" id="btn-toggle-documento">CNPJ</button>
                                                <input type="text" class="form-control form-control-lg" id="input-documento" placeholder="Digite o CNPJ...">
                                                <button class="btn btn-primary" type="button" id="btn-consultar-documento">
                                                    <i class="bi bi-search me-2"></i>Consultar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div id="loading-consulta" class="text-center my-4" style="display: none;">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Consultando...</span>
                                        </div>
                                        <p class="mt-2">Consultando cliente...</p>
                                    </div>

                                    <div id="resultado-consulta" class="mt-4" style="display: none;">
                                        <div id="cliente-encontrado">
                                            <h5 class="text-success"><i class="bi bi-check-circle-fill me-2"></i>Cliente Encontrado</h5>
                                            <div class="ivp-card p-3">
                                                <p class="mb-1"><strong>Razão Social/Nome:</strong> <span id="cliente-nome"></span></p>
                                                <p class="mb-1"><strong>Documento:</strong> <span id="cliente-documento"></span></p>
                                                <p class="mb-0"><strong>ID Cliente:</strong> <span id="cliente-id"></span></p>
                                            </div>
                                            <div class="alert alert-danger mt-3" id="alerta-financeiro" style="display: none;">
                                            </div>
                                            <h6 class="mt-3">Contratos do Cliente:</h6>
                                            <ul class="list-group" id="lista-contratos">
                                            </ul>
                                        </div>
                                        
                                        <div id="cliente-nao-encontrado">
                                            <h5 class="text-warning"><i class="bi bi-exclamation-triangle-fill me-2"></i>Cliente Não Encontrado</h5>
                                            <p>Nenhum cliente encontrado com este documento.</p>
                                        </div>
                                    </div>
                                </fieldset>
                                
                                <div class="ivp-actions mt-5" id="bloco-acao-proximo" style="display: none;">
                                    <button type="button" id="btn-ir-para-cadastro" class="ivp-btn">
                                    </button>
                                </div>
                                <fieldset class="form-section mt-4">
                                    <legend class="section-legend">Consulta por CEP e Número</legend>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label for="input-cep-consulta" class="form-label">CEP</label>
                                            <input type="text" class="form-control" id="input-cep-consulta" placeholder="00000-000">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="input-numero-consulta" class="form-label">Número</label>
                                            <input type="text" class="form-control" id="input-numero-consulta" placeholder="Ex: 123">
                                        </div>
                                        <div class="col-md-3 d-flex align-items-end">
                                            <button class="btn btn-primary w-100" type="button" id="btn-consultar-endereco">
                                                <i class="bi bi-search me-2"></i>Consultar
                                            </button>
                                        </div>
                                        <div id="loading-endereco" class="text-center my-4" style="display: none;">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Consultando...</span>
                                            </div>
                                        </div>
                                        <div id="resultado-endereco" class="mt-3" style="display: none;">
                                            <h6 class="mt-3">Clientes no mesmo endereço:</h6>
                                            <ul class="list-group" id="lista-clientes-endereco">
                                            </ul>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </div>

                    <div id="tela-2-cadastro" style="display: none;">
                        <div class="ivp-card">
                            <div class="card-body p-4 p-md-5">
                                
                                <button type="button" id="btn-voltar-consulta" class="btn btn-outline-secondary btn-sm mb-3">
                                    <i class="bi bi-arrow-left me-1"></i> Voltar para Consulta
                                </button>
                                
                                <form id="venda-form" class="needs-validation" novalidate>
                                    <h2 class="ivp-title mb-4" id="titulo-form-cadastro">2. Cadastro de Venda Corporativo</h2>
                                    
                                    <fieldset class="form-section">
                                        <legend class="section-legend">Dados da Empresa / Cliente</legend>
                                        <div class="row g-3">
                                            <div class="col-md-12">
                                                <label for="nome" class="form-label">Razão Social / Nome Completo<span style="color: red;"> * </span></label>
                                                <input type="text" class="form-control" id="nome" required>
                                                <div class="invalid-feedback">Informe a Razão Social ou Nome.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="cpf" class="form-label">CNPJ / CPF<span style="color: red;"> * </span></label>
                                                <div class="input-group has-validation">
                                                    <input type="text" class="form-control" id="cpf" required>
                                                    <button class="btn btn-outline-primary" type="button" id="btn-cartao-cpf">Situação Cadastral</button>
                                                    <div class="invalid-feedback">Documento inválido.</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="data_nascimento" class="form-label">Data de Abertura / Nascimento<span style="color: red;"> * </span></label>
                                                <input type="date" class="form-control" id="data_nascimento" required>
                                                <div class="invalid-feedback">Data inválida.</div>
                                            </div>
                                        </div>
                                    </fieldset>
                                    
                                    <fieldset class="form-section mt-4">
                                        <legend class="section-legend">Contato</legend>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label for="whatsapp" class="form-label">WhatsApp Principal<span style="color: red;"> * </span></label>
                                                <input type="tel" class="form-control" id="whatsapp" required placeholder="(00) 00000-0000">
                                                <div class="invalid-feedback">WhatsApp inválido.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="telefone_celular" class="form-label">Telefone Secundário</label>
                                                <input type="tel" class="form-control" id="telefone_celular" placeholder="(00) 0000-0000">
                                            </div>
                                            <div class="col-md-12">
                                                <label for="email" class="form-label">E-mail<span style="color: red;"> * </span> </label>
                                                <input type="email" class="form-control" id="email" required placeholder="empresa@email.com">
                                                <div class="invalid-feedback">E-mail inválido.</div>
                                            </div>
                                        </div>
                                    </fieldset>

                                    <fieldset class="form-section mt-4" id="section-endereco-cliente" style="display: none;">
                                        <legend class="section-legend">Endereço do Cliente (Matriz/Fiscal)</legend>
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <label for="cep_cliente" class="form-label">CEP<span style="color: red;"> * </span></label>
                                                <input type="text" class="form-control" id="cep_cliente" placeholder="00000-000">
                                                <div class="invalid-feedback">CEP inválido.</div>
                                            </div>
                                            <div class="col-md-8">
                                                <label for="endereco_cliente" class="form-label">Endereço (Rua/Avenida)</label>
                                                <input type="text" class="form-control bg-light" id="endereco_cliente" readonly>
                                            </div>
                                            <div class="col-md-4">
                                                <label for="numero_cliente" class="form-label">Número<span style="color: red;"> * </span></label>
                                                <input type="text" class="form-control" id="numero_cliente">
                                            </div>
                                            <div class="col-md-8">
                                                <label for="bairro_cliente" class="form-label">Bairro</label>
                                                <input type="text" class="form-control bg-light" id="bairro_cliente" readonly>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="cidade_cliente" class="form-label">Cidade</label>
                                                <input type="text" class="form-control bg-light" id="cidade_cliente" readonly>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="uf_cliente" class="form-label">Estado (UF)</label>
                                                <input type="text" class="form-control bg-light" id="uf_cliente" readonly>
                                            </div>
                                            <div class="col-md-12">
                                                <label for="complemento_cliente" class="form-label">Complemento</label>
                                                <input type="text" class="form-control" id="complemento_cliente">
                                            </div>
                                            <input type="hidden" id="hidden-cidade-id-cliente">
                                        </div>
                                    </fieldset>

                                    <fieldset class="form-section mt-4">
                                        <legend class="section-legend">Endereço de Instalação</legend>
                                        <div class="row g-3">
                                            <div class="col-md-12 ivp-search-box mb-3">
                                                <label for="input-condominio-venda" class="form-label">Condomínio / Localidade<span style="color: red;"> * </span></label>
                                                <input type="text" class="form-control form-control-lg ivp-input" id="input-condominio-venda" value="Corporativo" required>
                                                <div class="invalid-feedback">Selecione a localidade (Padrão: Corporativo).</div>
                                            </div>
                                            
                                            <div class="col-md-4">
                                                <label for="cep" class="form-label">CEP<span style="color: red;"> * </span></label>
                                                <input type="text" class="form-control" id="cep" placeholder="00000-000" required>
                                                <div class="invalid-feedback">CEP inválido.</div>
                                            </div>
                                            <div class="col-md-8">
                                                <label for="endereco" class="form-label">Endereço (Rua/Avenida)</label>
                                                <input type="text" class="form-control bg-light" id="endereco" required readonly>
                                                <div class="form-text text-muted small">Preenchido automaticamente pelo CEP.</div>
                                            </div>
                                            <div class="col-md-4">
                                                <label for="numero" class="form-label">Número<span style="color: red;"> * </span></label>
                                                <div class="input-group has-validation">
                                                    <input type="text" class="form-control" id="numero" required>
                                                    <button class="btn btn-outline-secondary" type="button" id="btn-sem-numero" title="Sem Número">S/N</button>
                                                    <div class="invalid-feedback">Informe o número ou S/N.</div>
                                                </div>
                                            </div>
                                            <div class="col-md-8">
                                                <label for="bairro" class="form-label">Bairro</label>
                                                <input type="text" class="form-control bg-light" id="bairro" required readonly>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="cidade" class="form-label">Cidade</label>
                                                <input type="text" class="form-control bg-light" id="cidade" required readonly>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="uf" class="form-label">Estado (UF)</label>
                                                <input type="text" class="form-control bg-light" id="uf" required readonly>
                                            </div>
                                            
                                            <div class="col-12">
                                                <label for="btn-complemento" class="form-label">Complemento (Bloco, Sala, Andar, etc.)<span style="color: red;"> * </span></label>
                                                <input type="text" class="form-control" id="complemento" required placeholder="Ex: Sala 101, Andar 2, Prédio B">
                                                <div class="invalid-feedback">Por favor, selecione o complemento.</div>
                                            </div>
                                            <div class="col-12">
                                                <label for="referencia" class="form-label">Ponto de Referência</label>
                                                <input type="text" class="form-control" id="referencia"> 
                                            </div>
                                            <input type="hidden" id="hidden-condominio-id" value="10010">
                                            <input type="hidden" id="hidden-cidade-id">
                                            <input type="hidden" id="hidden-bloco">
                                            <input type="hidden" id="hidden-apartamento">
                                        </div>
                                    </fieldset>

                                    <fieldset class="form-section mt-4">
                                        <legend class="section-legend">Detalhes da Venda</legend>
                                         <div class="row g-3">
                                             <div class="col-md-6">
                                                 <label for="vendedor" class="form-label">Vendedor<span style="color: red;"> * </span></label>
                                                 <select id="vendedor" class="form-select" required>
                                                     <option selected disabled value="">Carregando...</option>
                                                 </select>
                                                  <div class="invalid-feedback">Selecione o vendedor.</div>
                                             </div>
                                             <div class="col-md-6">
                                                <label for="plano-display-btn" class="form-label">Plano Corporativo<span style="color: red;"> * </span></label>
                                                <div id="plano-helper" class="form-text mt-0 mb-1">Selecione o plano no botão abaixo.</div>
                                                <button type="button" class="form-control btn btn-outline-primary text-start" id="plano-display-btn" data-bs-toggle="modal" data-bs-target="#planosModal" required>
                                                    <i class="bi bi-list-check me-2"></i> Selecionar Plano...
                                                </button>
                                                <input type="hidden" id="plano" required>
                                                <div class="invalid-feedback">Selecione o plano.</div>
                                            </div>
                                             <div class="col-md-6">
                                                <label for="data_vencimento" class="form-label">Data de Vencimento<span style="color: red;"> * </span></label>
                                                <select id="data_vencimento" class="form-select" required>
                                                    <option selected disabled value="">Selecione...</option>
                                                    <option>5</option>
                                                    <option>10</option>
                                                    <option>15</option>
                                                    <option>20</option>
                                                </select>
                                                 <div class="invalid-feedback">Selecione a data de vencimento.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="valor_acordado" class="form-label">Valor Acordado (R$)<span style="color: red;"> * </span></label>
                                                <input type="text" class="form-control" id="valor_acordado" required placeholder="0,00">
                                                <div class="invalid-feedback">Informe o valor acordado.</div>
                                            </div>
                                        </div>
                                    </fieldset>

                                    <fieldset class="form-section mt-4">
                                        <legend class="section-legend">Observações do chamado / OS</legend>
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <textarea class="form-control" id="observacoes_venda" rows="4"></textarea> 
                                            </div>
                                        </div>
                                    </fieldset>

                                    <div class="ivp-actions mt-5">
                                        <div id="form-validity-message" class="form-text text-danger mb-2 text-center" style="display: none; font-weight: 500;">
                                            Por favor, preencha todos os campos obrigatórios.
                                        </div>
                                        <button type="submit" id="btn-finalizar-venda" class="ivp-btn" disabled>
                                            Finalizar Cadastro <i class="bi bi-check-circle-fill ms-2"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <footer class="ivp-footer">
         <div class="container-fluid py-3">
            <div class="text-center">
                <img src="images/logo.png" alt="Logo Intervip" width="100">
                <p class="ivp-footer-text">
                    © 2025 Gerência Intervip | Desenvolvido por 
                    <a href="https://github.com/guilherme-wallace" target="_blank">Guilherme Wallace</a>
                </p>
            </div>
        </div>
    </footer>

    <div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalLabel">Aviso</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="modalBody"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmModalLabel">Confirmação</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="confirmModalBody"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Não</button>
                <button type="button" class="btn btn-primary" id="btn-confirm-yes">Sim</button>
            </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="complementoModal" tabindex="-1" aria-labelledby="complementoModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="complementoModalLabel">Selecionar Complemento</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row">
                <div class="col-md-5">
                    <h6>1. Selecione o Bloco / Tipo</h6>
                    <div id="blocos-lista-modal" class="list-group" style="max-height: 300px; overflow-y: auto;"></div>
                </div>
                <div class="col-md-7">
                    <div id="complemento-details" style="display: none;"></div>
                </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" id="btn-confirmar-complemento" style="display: none;">Confirmar</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="planosModal" tabindex="-1" aria-labelledby="planosModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="planosModalLabel">Seleção de Planos Corporativos Ativos</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="text" class="form-control mb-3" id="filtro-planos" placeholder="Filtrar por nome ou valor...">
                    <div id="loading-planos" class="text-center my-4" style="display: none;">
                        <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Carregando Planos...</span></div>
                    </div>
                    <div id="lista-planos-modal" class="list-group" style="max-height: 400px; overflow-y: auto;">
                    </div>
                    <p class="text-center text-muted mt-3" id="plano-vazio" style="display: none;">Nenhum plano encontrado com o filtro aplicado.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>
	<div id="modalAlerta">
	  <div id="modalContent">
		<h3>Você não pode passar!</h3>
		<img src="images/lord-of-the-rings-you-shall-not-pass.gif" alt="You shall not pass GIF">
		<button id="closeModalBtn">Fechar</button>
	  </div>
	</div>
    <div class="modal fade" id="suporteModal" tabindex="-1" aria-labelledby="suporteModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title" id="suporteModalLabel"><i class="bi bi-tools me-2"></i>Reportar Problema Técnico</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="form-suporte">
                        <div class="mb-3">
                            <label for="descricao-problema" class="form-label">Descreva o problema encontrado:</label>
                            <textarea class="form-control" id="descricao-problema" rows="5" placeholder="Informe aqui o problema encontrado." required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="btn-enviar-suporte">
                        Enviar Chamado <i class="bi bi-send-fill ms-1"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="javascripts/jquery.js"></script>
    <script src="javascripts/bootstrap.bundle.min.js"></script>
    <script src="javascripts/bootstrap-autocomplete.min.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.9/jquery.inputmask.min.js"></script>
    <script src="javascripts/cadastro-corporativo.js"></script>
</body>
</html>